<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>TrailTales - Your Ultimate Trip Companion</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/lucide@latest"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Poppins', sans-serif;
            -webkit-tap-highlight-color: transparent;
        }
        .screen {
            display: none;
        }
        .screen.active {
            display: block;
        }
        /* Custom scrollbar for dark theme */
        ::-webkit-scrollbar {
            width: 5px;
        }
        ::-webkit-scrollbar-track {
            background: #2d3748; /* gray-800 */
        }
        ::-webkit-scrollbar-thumb {
            background: #718096; /* gray-500 */
            border-radius: 5px;
        }
        ::-webkit-scrollbar-thumb:hover {
            background: #a0aec0; /* gray-400 */
        }
        .nav-button.text-blue-600 {
            color: #60a5fa; /* A brighter blue for dark mode */
        }
    </style>
</head>
<body class="bg-gray-900 text-gray-200 flex items-center justify-center min-h-screen">

    <!-- Login Screen -->
    <div id="login-screen" class="w-full max-w-sm p-8 space-y-6 bg-gray-800 rounded-2xl shadow-lg">
        <div class="text-center">
            <h1 class="text-3xl font-bold text-white">TrailTales</h1>
            <p class="text-gray-400">Your Ultimate Trip Companion</p>
        </div>
        <form id="login-form" class="space-y-4">
            <div>
                <label for="email" class="text-sm font-medium text-gray-300">Email</label>
                <input type="email" id="login-email" class="w-full p-3 mt-1 bg-gray-700 border border-gray-600 rounded-md text-white placeholder-gray-500" placeholder="you@example.com" required>
            </div>
            <div>
                <label for="password" class="text-sm font-medium text-gray-300">Password</label>
                <input type="password" id="login-password" class="w-full p-3 mt-1 bg-gray-700 border border-gray-600 rounded-md text-white placeholder-gray-500" placeholder="••••••••" required>
            </div>
            <p id="login-error" class="text-red-400 text-sm hidden">Invalid email or password.</p>
            <button type="submit" class="w-full py-3 px-4 bg-blue-600 hover:bg-blue-700 rounded-md text-white font-semibold transition">Login</button>
        </form>
    </div>


    <!-- Main container to simulate a mobile phone screen -->
    <div id="app-container" class="container mx-auto max-w-sm h-[95vh] md:h-[90vh] my-4 bg-gray-800 rounded-3xl shadow-2xl flex-col overflow-hidden border-4 border-black hidden">

        <!-- Header -->
        <header id="main-header" class="bg-gray-800 p-4 flex justify-between items-center border-b border-gray-700 z-10">
            <h1 id="header-title" class="text-xl font-bold text-white">My Trips</h1>
            <div class="flex items-center space-x-3">
                <p id="offline-indicator" class="text-xs font-semibold text-red-400 hidden">OFFLINE</p>
                <label for="offline-toggle" class="flex items-center cursor-pointer">
                    <div class="relative">
                        <input type="checkbox" id="offline-toggle" class="sr-only">
                        <div class="block bg-gray-600 w-10 h-6 rounded-full"></div>
                        <div class="dot absolute left-1 top-1 bg-white w-4 h-4 rounded-full transition"></div>
                    </div>
                </label>
                 <i data-lucide="bell" class="w-6 h-6 text-gray-400"></i>
            </div>
             <style>
                input:checked ~ .dot {
                    transform: translateX(100%);
                    background-color: #48bb78;
                }
             </style>
        </header>
        
        <!-- Back button header (for sub-screens) -->
        <header id="back-header" class="bg-gray-800 p-4 flex justify-between items-center border-b border-gray-700 z-10 hidden">
            <button id="back-button" class="p-1 rounded-full hover:bg-gray-700">
                <i data-lucide="arrow-left" class="w-6 h-6 text-gray-400"></i>
            </button>
            <h1 id="back-header-title" class="text-xl font-bold text-white">Trip Details</h1>
             <div class="w-6"></div> <!-- Placeholder for alignment -->
        </header>

        <!-- Main Content Area -->
        <main class="flex-grow overflow-y-auto pb-20 bg-gray-900">
            <!-- Trips Screen -->
            <div id="trips-screen" class="screen active p-4">
                <div id="trips-list" class="space-y-4">
                    <!-- Trip cards will be injected here -->
                </div>
                 <button id="add-trip-button" class="fixed bottom-20 right-8 md:right-[calc(50vw-170px)] bg-blue-500 text-white p-4 rounded-full shadow-lg hover:bg-blue-600 transition-transform transform hover:scale-110">
                    <i data-lucide="plus" class="w-6 h-6"></i>
                </button>
            </div>

            <!-- Itinerary Screen -->
            <div id="itinerary-screen" class="screen">
                <!-- Itinerary content will be injected here -->
            </div>

            <!-- Map Screen -->
            <div id="map-screen" class="screen relative h-full w-full">
                <!-- Map content will be injected here -->
            </div>
            
            <!-- Expenses Screen -->
            <div id="expenses-screen" class="screen p-4">
                 <div id="expenses-content">
                    <!-- Expenses content will be injected here -->
                 </div>
            </div>

            <!-- Connect Screen -->
            <div id="connect-screen" class="screen p-4">
                <h2 class="text-lg font-semibold mb-4 text-center text-white">Travelers Near You</h2>
                <div id="travelers-list" class="space-y-3">
                    <!-- Travelers will be injected here -->
                </div>
            </div>
            
            <!-- Profile Screen -->
            <div id="profile-screen" class="screen p-4 flex flex-col items-center">
                 <img id="profile-avatar" src="" alt="User Profile" class="w-24 h-24 rounded-full mb-4 ring-4 ring-blue-500">
                 <h2 id="profile-name" class="text-2xl font-bold text-white"></h2>
                 <p id="profile-email" class="text-gray-400"></p>

                 <div class="w-full mt-8 space-y-2">
                     <button class="w-full flex items-center p-3 bg-gray-700 rounded-lg hover:bg-gray-600">
                         <i data-lucide="user" class="w-5 h-5 mr-3"></i> Edit Profile
                     </button>
                      <button class="w-full flex items-center p-3 bg-gray-700 rounded-lg hover:bg-gray-600">
                         <i data-lucide="settings" class="w-5 h-5 mr-3"></i> Settings
                     </button>
                      <button class="w-full flex items-center p-3 bg-gray-700 rounded-lg hover:bg-gray-600">
                         <i data-lucide="help-circle" class="w-5 h-5 mr-3"></i> Help & Support
                     </button>
                       <button id="logout-button" class="w-full flex items-center p-3 mt-4 bg-red-900 bg-opacity-50 text-red-400 rounded-lg hover:bg-opacity-75">
                         <i data-lucide="log-out" class="w-5 h-5 mr-3"></i> Logout
                     </button>
                 </div>
            </div>

        </main>

        <!-- Bottom Navigation -->
        <nav class="absolute bottom-0 w-full max-w-sm bg-gray-800 border-t border-gray-700 flex justify-around rounded-b-3xl">
            <button data-screen="trips-screen" class="nav-button flex-1 flex flex-col items-center p-3 text-blue-600">
                <i data-lucide="map" class="w-6 h-6 mb-1"></i>
                <span class="text-xs font-medium">Trips</span>
            </button>
            <button data-screen="expenses-screen" class="nav-button flex-1 flex flex-col items-center p-3 text-gray-400">
                <i data-lucide="indian-rupee" class="w-6 h-6 mb-1"></i>
                <span class="text-xs font-medium">Expenses</span>
            </button>
            <button data-screen="connect-screen" class="nav-button flex-1 flex flex-col items-center p-3 text-gray-400">
                <i data-lucide="users" class="w-6 h-6 mb-1"></i>
                <span class="text-xs font-medium">Connect</span>
            </button>
            <button data-screen="profile-screen" class="nav-button flex-1 flex flex-col items-center p-3 text-gray-400">
                <i data-lucide="user-circle" class="w-6 h-6 mb-1"></i>
                <span class="text-xs font-medium">Profile</span>
            </button>
        </nav>
    </div>

    <!-- Modal for adding itinerary items -->
    <div id="add-item-modal" class="fixed inset-0 bg-black bg-opacity-70 hidden items-center justify-center p-4 z-50">
        <div class="bg-gray-800 rounded-lg p-6 w-full max-w-sm border border-gray-700">
            <h2 class="text-lg font-bold mb-4 text-white">Add Itinerary Item</h2>
            <form id="add-item-form">
                <input type="hidden" id="modal-trip-id">
                <div class="mb-4">
                    <label for="item-type" class="block text-sm font-medium text-gray-300 mb-1">Type</label>
                    <select id="item-type" class="w-full p-2 bg-gray-700 border border-gray-600 rounded-md text-white">
                        <option value="plane">Flight</option>
                        <option value="bed-double">Hotel</option>
                        <option value="utensils-crossed">Restaurant</option>
                        <option value="palmtree">Activity</option>
                    </select>
                </div>
                <div class="mb-4">
                    <label for="item-title" class="block text-sm font-medium text-gray-300 mb-1">Title</label>
                    <input type="text" id="item-title" placeholder="e.g., Flight to Goa" class="w-full p-2 bg-gray-700 border border-gray-600 rounded-md text-white" required>
                </div>
                <div class="mb-4">
                     <label for="item-time" class="block text-sm font-medium text-gray-300 mb-1">Date & Time</label>
                     <input type="datetime-local" id="item-time" class="w-full p-2 bg-gray-700 border border-gray-600 rounded-md text-white" required style="color-scheme: dark;">
                </div>
                <div class="flex justify-end space-x-2">
                    <button type="button" id="cancel-add-item" class="px-4 py-2 bg-gray-600 rounded-md hover:bg-gray-500">Cancel</button>
                    <button type="submit" class="px-4 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700">Add Item</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Modal for adding a new trip -->
    <div id="add-trip-modal" class="fixed inset-0 bg-black bg-opacity-70 hidden items-center justify-center p-4 z-50">
        <div class="bg-gray-800 rounded-lg p-6 w-full max-w-sm border border-gray-700">
            <h2 class="text-lg font-bold mb-4 text-white">Add a New Trip</h2>
            <form id="add-trip-form">
                <div class="mb-4">
                    <label for="trip-destination" class="block text-sm font-medium text-gray-300 mb-1">Destination</label>
                    <input type="text" id="trip-destination" placeholder="e.g., Manali, India" class="w-full p-2 bg-gray-700 border border-gray-600 rounded-md text-white" required>
                </div>
                <div class="mb-4">
                     <label for="trip-start-date" class="block text-sm font-medium text-gray-300 mb-1">Start Date</label>
                     <input type="date" id="trip-start-date" class="w-full p-2 bg-gray-700 border border-gray-600 rounded-md text-white" required style="color-scheme: dark;">
                </div>
                 <div class="mb-4">
                     <label for="trip-end-date" class="block text-sm font-medium text-gray-300 mb-1">End Date</label>
                     <input type="date" id="trip-end-date" class="w-full p-2 bg-gray-700 border border-gray-600 rounded-md text-white" required style="color-scheme: dark;">
                </div>
                <div class="flex justify-end space-x-2">
                    <button type="button" id="cancel-add-trip" class="px-4 py-2 bg-gray-600 rounded-md hover:bg-gray-500">Cancel</button>
                    <button type="submit" class="px-4 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700">Add Trip</button>
                </div>
            </form>
        </div>
    </div>


    <script>
        // --- MOCK DATA ---
        let trips = [
            {
                id: 1,
                destination: "Goa, India",
                startDate: "2025-12-05",
                endDate: "2025-12-12",
                image: "https://placehold.co/600x400/16a085/ffffff?text=Goa",
                itinerary: [
                    { id: 1, type: 'plane', title: "Flight to Goa (GOI)", time: "2025-12-05T09:00", details: "Flight 6E 234" },
                    { id: 2, type: 'bed-double', title: "Check-in at Beach Resort", time: "2025-12-05T12:00", details: "Confirmation #G54321" },
                    { id: 3, type: 'utensils-crossed', title: "Dinner at Fisherman's Wharf", time: "2025-12-05T20:00", details: "Near Calangute" },
                    { id: 4, type: 'palmtree', title: "Visit Baga Beach", time: "2025-12-06T11:00", details: "Water sports" },
                ],
                expenses: [
                    { id: 1, title: "Flight Ticket", category: "Transport", amount: 8000 },
                    { id: 2, title: "Seafood Dinner", category: "Food", amount: 2500 },
                    { id: 3, title: "Scooter Rental", category: "Transport", amount: 1500 },
                ]
            },
            {
                id: 2,
                destination: "Shimla, India",
                startDate: "2026-01-15",
                endDate: "2026-01-20",
                image: "https://placehold.co/600x400/2980b9/ffffff?text=Shimla",
                itinerary: [],
                expenses: []
            },
        ];

        const travelers = [
            { name: "Aarav P.", from: "Mumbai", mutualInterests: ["Street Food", "Cricket"], avatar: "https://placehold.co/100x100/FADBD8/C0392B?text=AP" },
            { name: "Priya S.", from: "Delhi", mutualInterests: ["History", "Shopping"], avatar: "https://placehold.co/100x100/D6EAF8/2E86C1?text=PS" },
            { name: "Rohan K.", from: "Bangalore", mutualInterests: ["Tech", "Trekking"], avatar: "https://placehold.co/100x100/D5F5E3/28B463?text=RK" },
        ];
        
        const userProfile = {
            name: "Hacknova",
            email: "hacknova01@gmail.com",
            avatarUrl: "https://placehold.co/100x100/E2E8F0/4A5568?text=H"
        };

        // --- DOM ELEMENTS ---
        const loginScreen = document.getElementById('login-screen');
        const appContainer = document.getElementById('app-container');
        const loginForm = document.getElementById('login-form');
        const loginEmail = document.getElementById('login-email');
        const loginPassword = document.getElementById('login-password');
        const loginError = document.getElementById('login-error');
        const logoutButton = document.getElementById('logout-button');

        const screens = document.querySelectorAll('.screen');
        const navButtons = document.querySelectorAll('.nav-button');
        const mainHeader = document.getElementById('main-header');
        const backHeader = document.getElementById('back-header');
        const backButton = document.getElementById('back-button');
        const headerTitle = document.getElementById('header-title');
        const backHeaderTitle = document.getElementById('back-header-title');
        const tripsList = document.getElementById('trips-list');
        const itineraryScreen = document.getElementById('itinerary-screen');
        const expensesContent = document.getElementById('expenses-content');
        const travelersList = document.getElementById('travelers-list');
        const offlineToggle = document.getElementById('offline-toggle');
        const offlineIndicator = document.getElementById('offline-indicator');
        const mapScreen = document.getElementById('map-screen');

        // Itinerary Item Modal Elements
        const addItemModal = document.getElementById('add-item-modal');
        const addItemForm = document.getElementById('add-item-form');
        const cancelAddItemBtn = document.getElementById('cancel-add-item');

        // Add Trip Modal Elements
        const addTripButton = document.getElementById('add-trip-button');
        const addTripModal = document.getElementById('add-trip-modal');
        const addTripForm = document.getElementById('add-trip-form');
        const cancelAddTripBtn = document.getElementById('cancel-add-trip');


        // --- STATE MANAGEMENT ---
        let currentTripId = null;

        // --- RENDER FUNCTIONS ---
        function formatDate(dateString) {
            const options = { month: 'short', day: 'numeric' };
            return new Date(dateString + 'T00:00:00').toLocaleDateString('en-US', options);
        }

        function renderTrips() {
            tripsList.innerHTML = trips.map(trip => `
                <div class="bg-gray-800 rounded-xl shadow-md overflow-hidden hover:shadow-lg transition-shadow cursor-pointer border border-gray-700 hover:border-gray-600" data-trip-id="${trip.id}">
                    <img class="h-40 w-full object-cover" src="${trip.image}" alt="${trip.destination}">
                    <div class="p-4">
                        <h3 class="text-lg font-bold text-white">${trip.destination}</h3>
                        <p class="text-sm text-gray-400">${formatDate(trip.startDate)} - ${formatDate(trip.endDate)}</p>
                    </div>
                </div>
            `).join('');

            document.querySelectorAll('[data-trip-id]').forEach(card => {
                card.addEventListener('click', () => {
                    currentTripId = parseInt(card.dataset.tripId);
                    renderItinerary();
                    showScreen('itinerary-screen');
                });
            });
        }
        
        function renderItinerary() {
            const trip = trips.find(t => t.id === currentTripId);
            if (!trip) return;

            itineraryScreen.innerHTML = `
                <div>
                    <img class="h-48 w-full object-cover" src="${trip.image}" alt="${trip.destination}">
                    <div class="p-4">
                        <div class="flex justify-between items-center">
                            <div>
                                <h2 class="text-2xl font-bold text-white">${trip.destination}</h2>
                                <p class="text-md text-gray-400">${formatDate(trip.startDate)} - ${formatDate(trip.endDate)}</p>
                            </div>
                            <button id="view-map-btn" class="flex items-center space-x-2 px-3 py-2 bg-gray-700 rounded-lg hover:bg-gray-600 transition">
                                <i data-lucide="map" class="w-5 h-5 text-gray-300"></i>
                                <span class="text-sm font-semibold">Map</span>
                            </button>
                        </div>
                    </div>
                </div>
                <div class="p-4">
                    <h3 class="text-lg font-semibold mb-3 text-white">Itinerary</h3>
                    <div id="itinerary-items" class="space-y-4">
                        ${trip.itinerary.sort((a,b) => new Date(a.time) - new Date(b.time)).map(item => `
                            <div class="flex items-start space-x-4">
                                <div class="bg-blue-900 bg-opacity-50 text-blue-300 p-3 rounded-full">
                                    <i data-lucide="${item.type}" class="w-5 h-5"></i>
                                </div>
                                <div>
                                    <p class="font-semibold text-white">${item.title}</p>
                                    <p class="text-sm text-gray-400">${new Date(item.time).toLocaleTimeString([], {hour: '2-digit', minute:'2-digit'})} - ${item.details}</p>
                                </div>
                            </div>
                        `).join('') || '<p class="text-gray-400">No itinerary items yet. Add one!</p>'}
                    </div>
                     <button id="add-itinerary-item-btn" class="mt-6 w-full py-2 bg-blue-600 text-white rounded-lg font-semibold hover:bg-blue-700">Add Item</button>
                </div>
            `;
            lucide.createIcons();
            document.getElementById('add-itinerary-item-btn').addEventListener('click', openAddItemModal);
            document.getElementById('view-map-btn').addEventListener('click', () => {
                renderMap();
                showScreen('map-screen');
            });
        }
        
        function renderExpenses() {
            let relevantExpenses = currentTripId ? (trips.find(t => t.id === currentTripId)?.expenses || []) : trips.flatMap(t => t.expenses);
            const total = relevantExpenses.reduce((sum, item) => sum + item.amount, 0);

            expensesContent.innerHTML = `
                 <div class="bg-gradient-to-br from-blue-500 to-indigo-600 text-white p-6 rounded-xl shadow-lg mb-6">
                    <p class="text-sm opacity-80">Total Expenses</p>
                    <p class="text-4xl font-bold">₹${total.toLocaleString('en-IN')}</p>
                </div>

                <div class="bg-green-900 bg-opacity-30 border-l-4 border-green-500 text-green-300 p-4 mb-6 rounded-r-lg">
                    <div class="flex">
                        <div class="py-1"><i data-lucide="lightbulb" class="w-5 h-5 mr-3"></i></div>
                        <div>
                            <p class="font-bold">AI Cost-Saving Tip</p>
                            <p class="text-sm">Booking flights and hotels in advance for Goa can lead to significant savings, especially during peak season!</p>
                        </div>
                    </div>
                </div>
                
                <h3 class="text-lg font-semibold mb-3 text-white">Breakdown</h3>
                <div class="space-y-3">
                    ${relevantExpenses.map(item => `
                        <div class="flex justify-between items-center bg-gray-800 p-3 rounded-lg border border-gray-700">
                            <div>
                                <p class="font-medium text-white">${item.title}</p>
                                <p class="text-xs text-gray-400 bg-gray-700 px-2 py-0.5 rounded-full inline-block">${item.category}</p>
                            </div>
                            <p class="font-semibold text-lg text-white">₹${item.amount.toLocaleString('en-IN')}</p>
                        </div>
                    `).join('') || '<p class="text-gray-400">No expenses logged.</p>'}
                </div>
            `;
             lucide.createIcons();
        }

        function renderConnect() {
            travelersList.innerHTML = travelers.map(t => `
                <div class="flex items-center bg-gray-800 p-3 rounded-lg border border-gray-700">
                    <img src="${t.avatar}" class="w-12 h-12 rounded-full mr-4">
                    <div class="flex-grow">
                        <p class="font-bold text-white">${t.name}</p>
                        <p class="text-sm text-gray-400">${t.from}</p>
                        <div class="flex flex-wrap gap-1 mt-1">
                            ${t.mutualInterests.map(interest => `<span class="text-xs bg-purple-900 bg-opacity-50 text-purple-300 px-2 py-0.5 rounded-full">${interest}</span>`).join('')}
                        </div>
                    </div>
                    <button class="bg-blue-500 bg-opacity-20 text-blue-300 p-2 rounded-full hover:bg-opacity-40">
                        <i data-lucide="message-circle" class="w-5 h-5"></i>
                    </button>
                </div>
            `).join('');
            lucide.createIcons();
        }

        function renderProfile() {
            document.getElementById('profile-avatar').src = userProfile.avatarUrl;
            document.getElementById('profile-name').textContent = userProfile.name;
            document.getElementById('profile-email').textContent = userProfile.email;
        }

        function renderMap() {
            const trip = trips.find(t => t.id === currentTripId);
            if (!trip) return;

            const pinPositions = [
                { top: '25%', left: '30%' }, { top: '40%', left: '65%' },
                { top: '60%', left: '20%' }, { top: '75%', left: '50%' },
                { top: '35%', left: '15%' }, { top: '55%', left: '80%' }
            ];

            mapScreen.innerHTML = `
                <img src="https://placehold.co/600x1000/2d3748/4a5468?text=Map+of+${trip.destination.split(',')[0]}" class="absolute inset-0 w-full h-full object-cover" alt="Map of ${trip.destination}">
                ${trip.itinerary.map((item, index) => {
                    const pos = pinPositions[index % pinPositions.length];
                    return `
                        <div class="absolute" style="top: ${pos.top}; left: ${pos.left};">
                            <div class="relative flex flex-col items-center group">
                                <div class="absolute bottom-full mb-2 hidden group-hover:block bg-white text-gray-800 text-xs px-2 py-1 rounded-md shadow-lg whitespace-nowrap">${item.title}</div>
                                <div class="bg-blue-500 p-2 rounded-full shadow-lg text-white ring-2 ring-white">
                                    <i data-lucide="${item.type}" class="w-5 h-5"></i>
                                </div>
                                <div class="w-2 h-2 bg-blue-500 rounded-full -mt-1 shadow-md"></div>
                            </div>
                        </div>
                    `;
                }).join('')}
            `;
            lucide.createIcons();
        }


        // --- UI & NAVIGATION ---
        function showScreen(screenId) {
            screens.forEach(screen => screen.classList.remove('active'));
            document.getElementById(screenId).classList.add('active');

            navButtons.forEach(button => {
                if (button.dataset.screen === screenId) {
                    button.classList.remove('text-gray-400');
                    button.classList.add('text-blue-600');
                } else {
                    button.classList.add('text-gray-400');
                    button.classList.remove('text-blue-600');
                }
            });
            
            if (screenId === 'itinerary-screen' || screenId === 'map-screen') {
                const trip = trips.find(t => t.id === currentTripId);
                let title = 'Details';
                if(trip) {
                    title = screenId === 'map-screen' ? `Map of ${trip.destination.split(',')[0]}`: trip.destination;
                }
                backHeaderTitle.textContent = title;
                mainHeader.classList.add('hidden');
                backHeader.classList.remove('hidden');
            } else {
                mainHeader.classList.remove('hidden');
                backHeader.classList.add('hidden');
                if(document.getElementById('itinerary-screen').classList.contains('active')) {
                   currentTripId = null; 
                }
            }
            
            switch(screenId) {
                case 'trips-screen': headerTitle.textContent = 'My Trips'; break;
                case 'expenses-screen': headerTitle.textContent = 'Expenses'; renderExpenses(); break;
                case 'connect-screen': headerTitle.textContent = 'Connect'; renderConnect(); break;
                case 'profile-screen': headerTitle.textContent = 'Profile'; renderProfile(); break;
            }
        }

        navButtons.forEach(button => {
            button.addEventListener('click', () => {
                const targetScreen = button.dataset.screen;
                showScreen(targetScreen);
            });
        });

        backButton.addEventListener('click', () => {
            if (document.getElementById('map-screen').classList.contains('active')) {
                showScreen('itinerary-screen');
            } else {
                showScreen('trips-screen');
            }
        });

        offlineToggle.addEventListener('change', (e) => {
            offlineIndicator.classList.toggle('hidden', !e.target.checked);
        });
        
        // --- MODAL LOGIC (ADD ITINERARY ITEM) ---
        function openAddItemModal() {
            document.getElementById('modal-trip-id').value = currentTripId;
            addItemModal.classList.remove('hidden');
            addItemModal.classList.add('flex');
        }

        function closeAddItemModal() {
            addItemModal.classList.add('hidden');
            addItemModal.classList.remove('flex');
            addItemForm.reset();
        }

        cancelAddItemBtn.addEventListener('click', closeAddItemModal);

        addItemForm.addEventListener('submit', (e) => {
            e.preventDefault();
            const tripId = parseInt(document.getElementById('modal-trip-id').value);
            const trip = trips.find(t => t.id === tripId);
            
            if (trip) {
                const newItem = {
                    id: Date.now(),
                    type: document.getElementById('item-type').value,
                    title: document.getElementById('item-title').value,
                    time: document.getElementById('item-time').value,
                    details: 'Details to be added'
                };
                trip.itinerary.push(newItem);
                renderItinerary();
            }
            closeAddItemModal();
        });

        // --- MODAL LOGIC (ADD TRIP) ---
        function openAddTripModal() {
            addTripModal.classList.remove('hidden');
            addTripModal.classList.add('flex');
        }

        function closeAddTripModal() {
            addTripModal.classList.add('hidden');
            addTripModal.classList.remove('flex');
            addTripForm.reset();
        }
        
        addTripButton.addEventListener('click', openAddTripModal);
        cancelAddTripBtn.addEventListener('click', closeAddTripModal);

        addTripForm.addEventListener('submit', (e) => {
            e.preventDefault();
            const destination = document.getElementById('trip-destination').value;
            const startDate = document.getElementById('trip-start-date').value;
            const endDate = document.getElementById('trip-end-date').value;

            const newTrip = {
                id: Date.now(),
                destination: destination,
                startDate: startDate,
                endDate: endDate,
                image: `https://placehold.co/600x400/3498db/ffffff?text=${destination.split(',')[0]}`,
                itinerary: [],
                expenses: []
            };

            trips.push(newTrip);
            renderTrips();
            closeAddTripModal();
        });
        
        // --- AUTHENTICATION ---
        loginForm.addEventListener('submit', (e) => {
            e.preventDefault();
            const email = loginEmail.value;
            const password = loginPassword.value;

            if (email === 'hacknova01@gmail.com' && password === '123456') {
                loginScreen.classList.add('hidden');
                appContainer.classList.remove('hidden');
                appContainer.classList.add('flex'); // Make it a flex container
                loginError.classList.add('hidden');
                loginPassword.value = '';
                initializeApp();
            } else {
                loginError.classList.remove('hidden');
            }
        });

        logoutButton.addEventListener('click', () => {
            appContainer.classList.add('hidden');
            appContainer.classList.remove('flex');
            loginScreen.classList.remove('hidden');
        });

        // --- INITIALIZATION ---
        function initializeApp() {
            lucide.createIcons();
            renderTrips();
            renderConnect();
            renderExpenses();
            renderProfile(); // <-- Bug fix is here
            showScreen('trips-screen');
        }

    </script>
</body>
</html>

